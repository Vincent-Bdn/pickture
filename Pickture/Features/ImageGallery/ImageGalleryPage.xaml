<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:Pickture.Features.ImageGallery"
             x:Class="Pickture.Features.ImageGallery.ImageGalleryPage"
             Title="Pickture"
             BackgroundColor="#FFFFFF">

    <Grid RowDefinitions="Auto,*" ColumnDefinitions="200,*">

        <!-- Left Thumbnail Panel -->
        <Grid Grid.Row="0" Grid.Column="0" Grid.RowSpan="2"
              BackgroundColor="#F5F5F5" Padding="0"
              RowDefinitions="Auto,*">
            
            <Label 
                Grid.Row="0"
                Text="Images" 
                Padding="10" 
                FontAttributes="Bold"
                FontSize="14"
                TextColor="#333333"/>

            <ScrollView
                x:Name="ThumbnailScrollView"
                Grid.Row="1"
                VerticalScrollBarVisibility="Always">
                
                <CollectionView 
                    x:Name="ThumbnailCollectionView"
                    ItemsSource="{Binding Images}"
                    SelectionMode="Single"
                    SelectionChangedCommand="{Binding SelectionChangedCommand}"
                    SelectionChangedCommandParameter="{Binding SelectedItemParameter}"
                    Scrolled="OnThumbnailCollectionScrolled">
                    
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout 
                            Orientation="Vertical" 
                            ItemSpacing="4"/>
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="4" WidthRequest="190" HeightRequest="150">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer 
                                        Tapped="OnThumbnailTapped"
                                        CommandParameter="{Binding .}"/>
                                </Grid.GestureRecognizers>

                                <Border 
                                    StrokeThickness="{Binding IsSelected, Converter={StaticResource SelectionWidthConverter}}"
                                    Stroke="{Binding IsSelected, Converter={StaticResource SelectionColorConverter}}"
                                    StrokeShape="RoundRectangle 4">
                                    <Frame CornerRadius="4" HasShadow="True" Padding="0" Margin="0">
                                        <local:ThumbnailItemControl ImageItem="{Binding .}"/>
                                    </Frame>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </ScrollView>
        </Grid>

        <!-- Image Info Bar (Top) -->
        <Grid Grid.Row="0" Grid.Column="1" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="15" Padding="10" VerticalOptions="Center">
            
            <!-- Filename on the left -->
            <Label 
                Grid.Column="0"
                Text="{Binding SelectedImage.FileName}" 
                FontSize="14"
                TextColor="#333333"
                VerticalOptions="Center"
                HorizontalOptions="Start"/>
            
            <!-- Processing Mode Toggle Buttons in the center -->
            <StackLayout Grid.Column="1" Orientation="Horizontal" Spacing="5" HorizontalOptions="Center">
                <Button 
                    Text="Original" 
                    Clicked="OnProcessingModeClicked"
                    CommandParameter="Original"
                    BackgroundColor="{Binding ProcessingMode, Converter={StaticResource ProcessingModeButtonColorConverter}, ConverterParameter=Original}"
                    TextColor="{Binding ProcessingMode, Converter={StaticResource ProcessingModeTextColorConverter}, ConverterParameter=Original}"
                    Padding="12,8"
                    FontSize="12"/>
                    
                <Button 
                    Text="White Balance (V)" 
                    Clicked="OnProcessingModeClicked"
                    CommandParameter="WhiteBalanceValue"
                    BackgroundColor="{Binding ProcessingMode, Converter={StaticResource ProcessingModeButtonColorConverter}, ConverterParameter=WhiteBalanceValue}"
                    TextColor="{Binding ProcessingMode, Converter={StaticResource ProcessingModeTextColorConverter}, ConverterParameter=WhiteBalanceValue}"
                    Padding="12,8"
                    FontSize="12"/>
                    
                <Button 
                    Text="White Balance (RGB)" 
                    Clicked="OnProcessingModeClicked"
                    CommandParameter="WhiteBalanceRGB"
                    BackgroundColor="{Binding ProcessingMode, Converter={StaticResource ProcessingModeButtonColorConverter}, ConverterParameter=WhiteBalanceRGB}"
                    TextColor="{Binding ProcessingMode, Converter={StaticResource ProcessingModeTextColorConverter}, ConverterParameter=WhiteBalanceRGB}"
                    Padding="12,8"
                    FontSize="12"/>
            </StackLayout>
            
            <!-- Select button on the right -->
            <Button
                Grid.Column="2"
                Text="Select"
                Clicked="OnSelectClicked"
                BackgroundColor="#007AFF"
                TextColor="White"
                Padding="12,8"
                FontSize="12"
                HorizontalOptions="End"/>
        </Grid>

        <!-- Main Image Display Area -->
        <Grid Grid.Row="1" Grid.Column="1" Padding="10">
            
            <!-- Image Display -->
            <Frame 
                CornerRadius="4" 
                HasShadow="True" 
                Padding="0" 
                Margin="0"
                HorizontalOptions="FillAndExpand"
                VerticalOptions="FillAndExpand">
                
                <Grid BackgroundColor="#E8E8E8">
                    <!-- Main Image -->
                    <Image 
                        x:Name="MainImage"
                        Aspect="AspectFit"
                        BackgroundColor="#E8E8E8"
                        Source="{Binding DisplayedImage}"
                        IsVisible="{Binding IsImageLoading, Converter={StaticResource InvertedBoolConverter}}"/>
                    
                    <!-- Loading Spinner -->
                    <ActivityIndicator 
                        IsRunning="{Binding IsImageLoading}"
                        IsVisible="{Binding IsImageLoading}"
                        Color="#007AFF"
                        Scale="2"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"/>
                </Grid>
            </Frame>
        </Grid>

    </Grid>

</ContentPage>
