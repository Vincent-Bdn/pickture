<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:Pickture.Features.ImageGallery"
             x:Class="Pickture.Features.ImageGallery.ImageGalleryPage"
             Title="Pickture"
             BackgroundColor="#FFFFFF">

    <Grid RowDefinitions="Auto,*"
          ColumnDefinitions="200,*">

        <!-- Left Thumbnail Panel -->
        <Grid Grid.Row="0"
              Grid.Column="0"
              Grid.RowSpan="2"
              BackgroundColor="#F5F5F5"
              Padding="0"
              RowDefinitions="Auto,*">

            <Label
                Grid.Row="0"
                Text="Images"
                Padding="10"
                FontAttributes="Bold"
                FontSize="14"
                TextColor="#333333"/>

            <CollectionView
                x:Name="ThumbnailCollectionView"
                Grid.Row="1"
                ItemsSource="{Binding Images}"
                SelectedItem="{Binding SelectedImage, Mode=TwoWay}"
                SelectionMode="Single"
                VerticalScrollBarVisibility="Always"
                ItemsUpdatingScrollMode="KeepScrollOffset">

                <CollectionView.ItemsLayout>
                    <LinearItemsLayout
                        Orientation="Vertical"
                        ItemSpacing="4"/>
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="4"
                              WidthRequest="190"
                              HeightRequest="150">

                            <Border
                                StrokeThickness="{Binding IsSelected, Converter={StaticResource SelectionWidthConverter}}"
                                Stroke="{Binding IsSelected, Converter={StaticResource SelectionColorConverter}}"
                                StrokeShape="RoundRectangle 4">

                                <Frame CornerRadius="4"
                                       HasShadow="True"
                                       Padding="0"
                                       Margin="0">

                                    <local:ThumbnailItemControl />

                                </Frame>
                            </Border>

                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </Grid>

        <!-- Image Info Bar (Top) -->
        <Grid Grid.Row="0"
              Grid.Column="1"
              ColumnDefinitions="*"
              ColumnSpacing="15"
              Padding="10"
              VerticalOptions="Center">

            <Grid ColumnDefinitions="*,Auto"
                  ColumnSpacing="15">
                <!-- Filename on the left -->
                <Label
                    Grid.Column="0"
                    Text="{Binding SelectedImage.FileName}"
                    FontSize="14"
                    TextColor="#333333"
                    VerticalOptions="Center"
                    HorizontalOptions="Start"/>

                <!-- Add to Selection button on the right -->
                <Button
                    Grid.Column="1"
                    Text="+ Add to selection"
                    Clicked="OnAddToSelectionClicked"
                    BackgroundColor="#007AFF"
                    TextColor="White"
                    Padding="12,8"
                    FontSize="12"
                    HorizontalOptions="End"/>
            </Grid>
        </Grid>

        <!-- Main Image Display Area -->
        <Grid Grid.Row="1"
              Grid.Column="1"
              Padding="10">

            <!-- Image Display -->
            <Frame
                CornerRadius="4"
                HasShadow="True"
                Padding="0"
                Margin="0"
                HorizontalOptions="FillAndExpand"
                VerticalOptions="FillAndExpand">

                <Grid BackgroundColor="#E8E8E8">
                    <!-- Main Image -->
                    <Image
                        x:Name="MainImage"
                        Aspect="AspectFit"
                        BackgroundColor="#E8E8E8"
                        Source="{Binding DisplayedImage}"
                        IsVisible="{Binding IsImageLoading, Converter={StaticResource InvertedBoolConverter}}"/>

                    <!-- Loading Spinner -->
                    <ActivityIndicator
                        IsRunning="{Binding IsImageLoading}"
                        IsVisible="{Binding IsImageLoading}"
                        Color="#007AFF"
                        Scale="2"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"/>
                </Grid>
            </Frame>
        </Grid>

    </Grid>

</ContentPage>
